# 图片字幕生成器 PRD

## 一、产品概述
- 目标：提供一个网页工具，在用户上传图片后，可在图片底部按多行文本生成统一风格的字幕，每一行文字的背景完全一致，呈现“切割感”的分隔效果，并支持导出生成结果。
- 适用场景：海报/文章配图/社媒图片制作等，强调底部多行字幕的统一视觉与分割感。
- 核心特性：
  - 上传图片并实时预览
  - 多行文本输入，自动拆分为逐行字幕
  - 每行字幕拥有统一背景样式（同色、同高度、同透明度、同分隔线风格）
  - 统一的“切割感”分隔效果（每行背景相同并以分隔线/等距排列形成切割视觉）
  - 字体大小、文字颜色、文字轮廓颜色可配置
  - 一键生成与保存图片

## 二、目标与范围
- 必做：上传图片、配置字幕参数、多行文本输入、底部统一风格渲染、预览与导出。
- 非本期：云端存储、历史记录、模板管理、复杂排版（逐字特效）等。

## 三、用户场景
- 用户上传一张背景图，在底部以多行字幕说明内容；每一行文字的背景保持一致（高度、颜色、透明度、分隔线），整齐叠放，形成明显的切割感；用户调整参数至满意后导出。

## 四、关键术语
- 字幕行：指输入框中每一行文本对应的一条底部字幕。
- 行背景：每一条字幕文字背后的矩形条，样式全局统一。
- 分隔线（切割线）：用于在视觉上分隔各行背景的细线/边界。

## 五、功能需求
1) 图片上传
- 支持拖拽或点击选择本地文件
- 支持格式：PNG、JPG、JPEG（可扩展 WebP）
- 成功后在预览区域显示图片原尺寸或等比缩放（不裁切）

2) 文本输入
- 多行文本输入框，按换行符拆分为多条字幕行
- 支持空行（渲染为空的背景行或跳过，可通过“空行处理”选项配置，默认跳过）

3) 参数配置
- 字幕高度(px)：每一行背景矩形的高度（默认 40）
- 字体大小(px)：每行文字的字号（默认 20）
- 字体颜色：支持颜色选择器（默认 #FFFFFF）
- 文字轮廓颜色：描边/轮廓颜色选择器（默认 #000000）
- 行间距(px)：行与行之间的垂直间距（默认 8；仅用于背景矩形与分隔线布局，不改变字体行距）
- 底部外边距(px)：字幕区域距离图片底边的距离（默认 24）
- 背景颜色：每行字幕背景矩形颜色（默认 #000000，含透明度）
- 背景透明度：0–1（默认 0.35）
- 分隔线颜色：用于形成切割感的分隔线颜色（默认 #FFFFFF）
- 分隔线高度(px)：默认 1（可为 0 表示不绘制分隔线，仍保持统一背景）
- 对齐方式：文字水平居中（默认），可扩展左对齐/右对齐

4) 渲染与预览
- 在底部区域按顺序从上到下渲染各字幕行：背景矩形 -> 分隔线 -> 文本
- 所有行背景样式一致：同高度、同颜色、同透明度、同圆角（如有）、同边框（如有）
- 分隔线与背景形成统一“切割感”（例如矩形条上方绘制细白线）
- 文本居中，文字带统一轮廓（描边），提升可读性
- 预览区域实时更新（参数改动或文本修改后立即重绘）

5) 导出
- 导出为 PNG（默认），支持透明通道（如背景不覆盖整个底部时）
- 导出分辨率与预览一致（不重新缩放）

6) 操作按钮
- 生成字幕图片：依据当前参数立即重绘
- 保存图片：将当前预览画布导出为文件并触发下载

## 六、交互与 UI 布局
- 顶部：工具标题（图片字幕生成器）
- 表单区：
  - 文件选择器（显示已选择文件名）
  - 字幕高度、字体大小、字体颜色、轮廓颜色、行间距、底部外边距、背景颜色、背景透明度、分隔线颜色、高度、对齐方式
  - 多行文本输入框（占据宽度，行高随浏览器默认设置）
  - 生成与保存按钮（并排或栅格布局）
- 预览区：显示生成结果（等比缩放至容器，保持清晰）

## 七、渲染规则（详细）
- 画布初始化：以图片尺寸创建 Canvas（宽 = 图片宽度；高 = 图片高度）
- 文本处理：按换行符拆分；去除尾随空白；空行按配置处理（默认跳过）
- 底部区域布局：
  - 从底部外边距开始向上，依次为每一行计算其矩形起始 y 坐标
  - 每行实际占用高度 = 字幕高度 + 行间距（最后一行不额外加行间距，可配置）
- 背景矩形：
  - 宽度 = 图片宽度，x=0
  - 高度 = 字幕高度
  - 颜色 = 背景颜色 + 背景透明度（统一）
  - 圆角与边框默认为 0（统一），如未来需要可统一配置
- 分隔线（切割感）：
  - 在每行背景矩形的上边沿绘制一条分隔线（高度 = 分隔线高度；颜色统一）
  - 线的宽度同图片宽度
  - 第一行可选择是否绘制分隔线（默认绘制，形成顶部边界）
- 文字绘制：
  - 水平居中（或按对齐选项）
  - 垂直居中于该行背景矩形
  - 字体大小统一
  - 轮廓颜色统一，描边宽度固定值（如 2px），提升对比与可读性
  - 行内过长文本自动换行或缩放（默认换行，最大行宽 = 图片宽度 * 0.9）

## 八、输入与校验
- 图片：限制最大体积（如 10MB），类型校验，不合格给出错误提示
- 文本：允许中英文与标点，控制最大行数（如 20 行），防止超出底部可布局区域（溢出时给出提示或滚动方案）
- 参数：数值型参数范围与默认值校验（如高度 20–120，字号 12–72 等）

## 九、性能与兼容
- 浏览器：兼容现代浏览器（Chrome、Edge、Safari、Firefox 最新两个版本）
- 渲染：纯前端 Canvas 绘制，不依赖后端服务
- 本地：不上传用户图片到服务器（本地处理），保障隐私

## 十、可配置参数（默认值建议）
- 字幕高度：40px
- 字体大小：20px
- 字体颜色：#FFFFFF
- 文字轮廓颜色：#000000
- 行间距：8px
- 底部外边距：24px
- 背景颜色：#000000
- 背景透明度：0.35
- 分隔线颜色：#FFFFFF
- 分隔线高度：1px
- 对齐方式：居中
- 空行处理：跳过

## 十一、可用性与辅助功能
- 错误提示清晰（文件类型、大小、参数越界等）
- 颜色输入支持直接输入 HEX/RGB
- 字体选择可扩展（首期仅使用系统默认字体或指定安全字体）

## 十二、边界与异常处理
- 行数过多超过底部可容纳空间：提示用户减少行数或减小高度/字号
- 超长文本：自动换行，最多两行；超过则缩小字号或提示裁剪
- 无图片：禁用生成与保存按钮
- 渲染失败：提示“请更换图片或刷新重试”

## 十三、验收标准
- 上传图片后，底部按多行文本生成字幕，每一行背景样式完全一致
- 分隔线统一，形成明显的切割感
- 字体大小、字体颜色、轮廓颜色可调，预览实时更新
- 导出 PNG 与预览一致（尺寸与效果一致）

## 十四、里程碑
- M1：基础上传/预览/参数面板/多行渲染
- M2：切割感分隔线实现与导出
- M3：异常与边界处理、兼容性优化

## 十五、技术方案摘要
- 前端：原生 HTML + CSS + JavaScript（或轻量框架），核心使用 Canvas API
- 关键实现：
  - 文件读取：FileReader / createImageBitmap 加载图片
  - 文本布局：measureText 计算宽度，按行宽换行
  - 背景与分隔线绘制：统一样式参数控制
  - 文字描边：ctx.strokeText + ctx.fillText
  - 导出：canvas.toDataURL('image/png')

## 十六、后续扩展（非本期）
- 字体选择、字重与字距
- 主题预设与模板保存
- 批量处理多张图片

